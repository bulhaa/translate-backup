<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
	<meta charset="UTF-8">
	<meta name="description" content="Translate from English to Dhivehi">
	<meta name="keywords" content="Dhivehi Maldives Maldivian Translate Language Translator Translating">
	<meta name="author" content="Hammadh Abdul Rahman">
  <title>English-Dhivehi Translator</title>
	
  
	<style type="text/css">
@charset "utf-8";

@font-face 		{ font-family: 'MV_Faseyha'; src:url('fonts/mv_faseyha.otf') format('opentype') }
/* @font-face 		{ font-family: 'MV_Waheed'; src:url('fonts/mv_waheed.otf') format('opentype') } */
	  html {
    font-family: GillSans, Calibri;
  }
.dText {
    font-family: MV_Faseyha;
    font-size: 200%;
/*	text-align: right;*/
	direction: rtl;
}
    </style>
	
  <!-- CSS  -->
  <link href="css/icon.css" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
	<link rel="stylesheet" href="jstree/dist/themes/default/style.min.css" />
  <!-- <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/> -->
  <!-- <link rel="stylesheet" href="css/jquery-ui.css"> -->
<!-- 	<style type="text/css">
 
  .draggable { width: 100px; height: 100px; padding: 0.5em; float: left; margin: 10px 10px 10px 0; }
  .droppable { width: 150px; height: 150px; padding: 0.5em; float: left; margin: 10px; }
	</style> -->
</head>
<body>
  <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper container">
	  <a id="logo-container" href="index.html" class="brand-logo">English-Dhivehi Translator</a>
      <ul class="right hide-on-med-and-down">
		<li class="active"><a href="index.html"><i class="material-icons">home</i></a></li>
		<li><a href="manage.html"><i class="material-icons">edit</i></a></li>
		<li><a href="download.html"><i class="material-icons">get_app</i></a></li>
     </ul>

      <ul id="nav-mobile" class="side-nav">
		<li class="active"><a href="index.html"><i class="material-icons left">home</i>Home</a></li>
		<li><a href="manage.html"><i class="material-icons left">edit</i>Manage</a></li>
		<li><a href="download.html"><i class="material-icons left">get_app</i>Download</a></li>
      </ul>
	  <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
	</div>
  </nav>
	
  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text">Rule Tree</h1>
      <div class="row center">
        <h5 class="header col s12 light"></h5>
      </div>
      <div class="row center">
      </div>
      <!-- <br><br> -->
    </div>
  </div>
	
  <div class="section no-pad-bot" id="index-banner">
    <!--<div class="container" style="height: 50vh">-->
    <div class="container">
			<div id="tree">
				<ul>
					<li>Root</li>
				</ul>
			</div><br>
		<div id="treeFeedback" class= "#ef9a9a red lighten-3" style="display:none"></div>
    </div>
  </div>
	
  <!-- <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text">Edit Rule</h1>
      <div class="row center">
        <h5 class="header col s12 light"></h5>
      </div>
      <div class="row center">
      </div>
      <br><br>
    </div>
  </div> -->

  <div class="section no-pad-bot" id="index-banner">
    <!--<div class="container" style="height: 50vh">-->
    <div class="container">
			<form class="" id="ruleForm" method="post" align = "center" action="" style="display:none">
				<div class="input-field">
					<input id="rule_Type" type="number" class="validate" required>
					<label id="rule_TypeL" for="rule_type">Type</label>
				</div>
				<div class="input-field">
					<input id="rule_Precedence" type="number" class="validate" required>
					<label id="rule_PrecedenceL" for="rule_Precedence">Precedence</label>
				</div>
				<div class="input-field">
					<input id="rule_Pattern" type="text" class="validate" required>
					<label id="rule_PatternL" for="rule_Pattern">Pattern</label>
				</div>
				<div class="input-field">
					<input id="rule_Order" type="text" class="validate" required>
					<label id="rule_OrderL" for="rule_Order">Order</label>
				</div>
				<div class="input-field">
					<input id="rule_Transformations" type="text" class="validate">
					<label id="rule_TransformationsL" for="rule_Transformations">Transformations</label>
				</div>
				<input class="waves-effect waves-light btn" type="submit" value="Update Rule"></input>
				<div class="progress" style="display:none">
					<div class="indeterminate"></div>
				</div>
			</form>
				<br>
		<div id="ruleFeedback" class= "#ef9a9a red lighten-3" style="display:none"></div>
    </div>
  </div>
	

	
	<footer class="page-footer orange">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">About</h5>
          <p class="grey-text text-lighten-4">We are a team of college students working on this project like it's our full time job. This project is too huge to accomplish on our own and we need your help to make this a success. Any help is greatly appreciated.</p>


        </div>
        <div class="col l3 s12">
          <h5 class="white-text">Developers</h5>
          <ul>
            <li><a class="white-text" href="mailto:freestyle.reunion@gmail.com" target="_blank">Hammadh</a></li>
            <li><a class="white-text" href="#!">Ashraq</a></li>
            <li><a class="white-text" href="#!"></a></li>
            <li><a class="white-text" href="#!"></a></li>
          </ul>
        </div>
        <div class="col l3 s12">
          <h5 class="white-text"></h5>
          <ul>
		<div id="pb-opennlp" class= "container l12 center">
			<a href="https://opennlp.apache.org/" target="_blank"><img src="images/pb-opennlp.jpg" alt=""  class="circle responsive-img l12" height="300" width="300"></a>
		</div>
		<li><a class="white-text" href="#!"></a></li>
            <li><a class="white-text" href="#!"></a></li>
            <li><a class="white-text" href="#!"></a></li>
            <li><a class="white-text" href="#!"></a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Templates by <a class="orange-text text-lighten-3" href="http://materializecss.com" target="_blank">Materialize</a>
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript">
	var jQuery_1_4_2 = $;
  </script>
  <script src="js/jquery-2.1.1.min.js"></script>
	<script src="jstree/dist/jstree.min.js"></script>
  <!-- <script type="text/javascript" src="js/jquery.soap.js"></script> -->
  <script src="js/jquery-ui.js"></script>
  <script src="../../bin/materialize.js"></script>
  <script src="js/init.js"></script>
  <!-- <script type="text/javascript" src="js/jtk-4.2.1.pack.js"></script> -->
  <script src="js/angular.min.js"></script>
  <script src="js/jquery.ui.touch-punch.min.js"></script>
  <script type="text/javascript" src="js/jquery.caret.1.02.js"></script>
<script>

var firebaseID;

$(document).ready(function(){

	$("#ruleForm").submit(function(event){
		event.preventDefault();
		updateRule();
	});
	$(".waves-input-wrapper").click(function(event){
		event.preventDefault();
		updateRule();
	});

function updateRule(){
	var rule='';
	rule = rule.concat($('#rule_Type').val(),',');
	rule = rule.concat($('#rule_Precedence').val(),',');
	rule = rule.concat($('#rule_Pattern').val(),',0,');
	rule = rule.concat($('#rule_Order').val(),',0,');
	if($('#rule_Transformations').val()!='')
		rule = rule.concat($('#rule_Transformations').val(),',');
		
	rule=rule.substring(0,rule.length-1);
	
	if($('#rule_Type').val()=="")
		return false;
		
	if($('#ruleForm .progress').is(':visible'))
		return false;
		
	$('#sentForm .progress').show();
	$.post("http://translate-dhivehi.rhcloud.com/Translator/services/TranslatorS?setRuleAdvanced",
	{
		key: firebaseID,
		rule: rule
	},
	function(data){
		/*var feedback = data.childNodes[0].childNodes[0].data;
		if(translation.indexOf('(Word to word translation)') > -1){
			translation = translation.replace('(Word to word translation)', '');
			$("#improve-div").show();
		}else
			$("#improve-div").hide();
		dText.innerHTML = translation;
		$("#dText").addClass('dText');
		$("#dText").show();
		$('#sentForm .progress').hide();*/
		$("#ruleFeedback").html("Rule added");
		$("#ruleFeedback").show();
	}).fail(function(xhr) {
		$("#ruleFeedback").html("Error: Connection issue or server internal error @SetRuleAdvanced");
		$("#ruleFeedback").show();

  });

	return false;
}

$("#tree").on('changed.jstree', function (e, data) {
    var i, j, r = [];
    for(i = 0, j = data.selected.length; i < j; i++) {
      //r.push(data.instance.get_node(data.selected[i]).text);
			//$('#tree').jstree(true).create_node(data.instance.get_node(data.selected[i]).id, newNode);

			var node =data.instance.get_node(data.selected[i]);
			//if(node.data=="type" && node.text<0){
			if(node.data=="type"){
				
				$('#tree').jstree(true).open_node(node);
				var children = $('#tree').jstree(true).get_children_dom (node);
				
				for(var a=0; a<children.length; a++){
					$('#tree').jstree(true).delete_node(children[a]);
				}
				
				
				/*if($('#tree').jstree(true).get_children_dom (node).length>0){
					var parent = node.parent;
					$('#tree').jstree(true).delete_node (node.id);
					
					var newNode = { text: text, data: "type", state: "open", "icon" : "images/tree-icon.png" };
					var node = $('#tree').jstree(true).create_node(parent, newNode);
				}else*/
				
				//if(node.text=="Root" && $('#tree').jstree(true).get_children_dom (1).length==0)
				if(node.text=="Root")
					loadRule(-1, 1);
				else
					loadRule(node.text, node);
				

			}else{
				firebaseID=node.data;
				$.post("http://translate-dhivehi.rhcloud.com/Translator/services/TranslatorS?getRule",
				{
					eText: node.data
				},
				function(data){
					var rule = data.childNodes[0].childNodes[0].data.replace("[","");
					rule = rule.replace("]","");
					rule = rule.split(", ");
					
					setText("#rule_Type", rule[0]);
					setText("#rule_Precedence", rule[1]);
					
					var stage = 1;
					var pattern = "";
					var order = "";
					var transformations = "";

					// seperate patter, order and transformation
					for (var i = 2; i < rule.length; i++) {
						if (rule[i] == 0) {
							stage++;
						} else if (stage == 1) {
							pattern = pattern.concat(rule[i],",");
						} else if (stage == 2) {
							order = order.concat(rule[i],",");
						} else {
							transformations = transformations.concat(rule[i],",");
						}
					}
					
					setText("#rule_Pattern", pattern.substring(0,pattern.length-1));
					setText("#rule_Order", order.substring(0,order.length-1));
					setText("#rule_Transformations", transformations.substring(0,transformations.length-1));

					/*var pattern = [];
					for (var i = 2; i < 2 + pattern.length; i++) {
						pattern[i - 2] = rule[i];
					}

					var order = [];
					for (var i = 2 + patternLen + 1; i < 2 + patternLen + 1 + orderLen; i++) {
						order[i - 2 - patternLen - 1] = rule[i];
					}

					transformations = new NanoRule[ruleLen / 2];
					for (var i = 2 + patternLen + 1 + orderLen + 1; i < rule.length; i += 2) {
						transformations[(i - 2 - patternLen - 1 - orderLen - 1)/2] = new NanoRule(rule[i], rule[i + 1]);
					}*/
					
					$('#tree').jstree(true).open_node(node);

					$("#ruleForm").show();
					$("#treeFeedback").hide();
				}).fail(function() {
					$("#treeFeedback").html("Error: Connection issue or server internal error @GetRule->LoadRule");
					$("#treeFeedback").show();
				});	
			}
			
				
				
			//else if(node.data="
    }
    $('#event_result').html('Selected: ' + r.join(', '));
  }).jstree({
		'core' : {
				'check_callback' : true,
				//'data': [{ 'id' : '1', 'text' : 'Root', 'state' : {'opened':true}, 'children' : ['sentence', 'child 2']}]
				'data': [{ 'id' : '1', 'text' : 'Root', data: "type", 'state' : {'opened':true}, "icon" : "images/tree-icon.png"}]
		},
    "checkbox": {
			"keep_selected_style": true
		},
		"plugins" : [ "contextmenu","wholerow","types","dnd","state" ]
	});
		loadRule(-1, 1);

/*$(function () { $root = $('#jstree_demo_div').jstree(
    'core' : {
        'data' : {
        'url' : 'info.json',
        'data' : function (node) {
            return { 'id' : node.id };
        },
        check_callback : true;
			}
		}
	); });*/
//var position = 'inside';
//var parent = '#child_node_1';
//var newNode = { state: "open", data: "New nooooode!" };
});

	$("#AddNode").click(function(event){
	
		
		/*var obj = {"id" : "1", "text" : "Root", "state" : {"opened":true}, "children" : ["child 1", "child 2"]};
		var newNode = { state: "open", data: "New nooooode!" };
		$('#tree').jstree(true).create_node('1', newNode);*/
	});
	
	function setText(control, text){
		$(control).val(text);
		$(control).addClass("valid");
		$(control.concat('L')).addClass("active");
	}
	
	function loadRule(type, nodeID){ 

		$.post("http://translate-dhivehi.rhcloud.com/Translator/services/TranslatorS?getRules",
		{
			eText: type
		},
		function(data){
			var rules = data.childNodes[0].childNodes;
			
			for(var a=0;a<rules.length/2;a++){
				//var newNode = { id: rules[a].childNodes[0].data, text: rules[rules.length/2+a].childNodes[0].data, data: "rule", state: "open" };
				var newNode = { text: rules[rules.length/2+a].childNodes[0].data, data: rules[a].childNodes[0].data, state: "open" };
				var rule = $('#tree').jstree(true).create_node(nodeID, newNode);
				//rule=rules[a].childNodes[0].data;
				
				var types = rules[rules.length/2+a].childNodes[0].data.split(", ");
				
				for(var b=0;b<types.length;b++){
					var newNode = { text: types[b], data: "type", state: "open", "icon" : "images/tree-icon.png" };
					$('#tree').jstree(true).create_node(rule, newNode);
				}
			}
			
			$('#tree').jstree(true).open_node(nodeID);
			$("#treeFeedback").hide();
		}).fail(function() {
			$("#treeFeedback").html("Error: Connection issue or server internal error @GetRule->LoadTree");
			$("#treeFeedback").show();
		});	
	}
	

</script>
  </body>
</html>
